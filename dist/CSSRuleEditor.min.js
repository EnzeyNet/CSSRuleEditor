!function(a,b){var c=a.module("net.enzey.service.css.editor",[]);c.service("nzCssRuleEditor",["$window","$http","$q",function(c,d,e){a.element(c.document.head).append(a.element("<style></style>"));var f=c.document.styleSheets[document.styleSheets.length-1],g=this,h={},i=function(a){var b=new RegExp("^.");a=a.split("-");for(var c=1;c<a.length;c++)a[c]=a[c].replace(b,a[c][0].toUpperCase());return a.join("")},j=function(a){var b;return b=a.value?a.value:a.style},k=function(a){var b;return b=a.rules?a.rules:a.cssRules},l=function(a){for(var b={},c=0;c<a.length;c++){var d=i(a[c]);b[d]=a[d]}return b},m=function(b){for(var c=k(b),d=0;d<c.length;d++){var e=c[d];if(e instanceof CSSStyleRule){var f=j(e);f=l(f),e.selectorText.split(",").forEach(function(b){b=b.replace(new RegExp("^ *"),""),b=b.replace(new RegExp(" *$"),""),o[b]||(o[b]={}),a.extend(o[b],f)})}}},n=function(){for(var b=c.document.styleSheets,f=new Array(b.length-1),g=[],h=0;h<b.length-1;h++)!function(){var i=h,j=b[h],l=e.defer();g.push(l.promise);try{k(j),f[i]=j,l.resolve(j)}catch(m){d.get(j.href).success(function(b){var d=a.element("<style></style>");d.html(b),a.element(c.document.head).prepend(d);var e=c.document.styleSheets,g=e[0];f[i]=g,d.remove(),l.resolve(g)}).error(function(){l.reject()})}}();var i=e.all(g).then(function(){return f});return i},o={},p=[];this.getBaseRules=function(){var b=n().then(function(b){return p=b,b.forEach(function(a){m(a)}),a.extend({},o)});return b},this.getCustomRule=function(a){if(a){var b=h[a];if(!b){f.insertRule(a+" {}",0);var c=k(f);h[a]=c[0],b=h[a]}return j(b)}},this.removeCustomRule=function(a){if(a)for(var b=k(f),c=0;c<b.length;c++){var d=b[c];d.selectorText.toLowerCase()===a.toLowerCase()&&(f.deleteRule(c),h[a]=null,delete h[a])}},this.getAllCustomRules=function(){return a.extend({},h)},this.removeAllCustomRules=function(){Object.keys(h).forEach(function(a){g.removeCustomRule(a)})};var q=function(a){a[1]<<20|a[2]<<10|a[3]},r={},s=function(a){var c=r[a];if(!c){var d=b.calculate(a)[0].specificity.split(",");r[a]=q(d),c=r[a]}return c};this.getStyles=function(b){var d=e.defer(),f=function(a){for(var d=c.document.querySelectorAll(a),e=0;e<d.length;e++)if(b===d[e])return a};return g.getBaseRules().then(function(b){var c=[];Object.keys(b).map(f).forEach(function(a){a&&c.push({rule:a,styles:b[a]})});var e=g.getAllCustomRules();Object.keys(e).map(f).forEach(function(a){a&&c.push({rule:a,styles:l(j(e[a]))})}),c.sort(function(a,b){return s(a.rule)-s(b.rule)});var h={};c.forEach(function(b){a.extend(h,b.styles)}),d.resolve(h)}),d.promise}}])}(angular,SPECIFICITY);